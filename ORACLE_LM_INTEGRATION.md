# ðŸ”® Oracle â†”ï¸ LM System Integration Guide

**Last Updated:** Nov 24, 2025  
**Purpose:** Complete documentation of how Footy Oracle v2 connects to the Football Betting AI System

---

## ðŸŽ¯ System Overview

**The Footy Oracle v2** is the **frontend presentation layer** that displays predictions generated by the **Football Betting AI System** (the backend ML engine).

### Two-Repository Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FOOTBALL BETTING AI SYSTEM (ML Engine)                      â”‚
â”‚  Repo: github.com/dannythehat/football-betting-ai-system    â”‚
â”‚                                                               â”‚
â”‚  âœ… Trains 4 ML models (Goals, Cards, Corners, BTTS)        â”‚
â”‚  âœ… Generates predictions with 133+ advanced features        â”‚
â”‚  âœ… Automated training (weekly) & testing (every 6 hours)    â”‚
â”‚  âœ… Produces JSON outputs with probabilities                 â”‚
â”‚  âœ… Exposes REST API for predictions                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    JSON Predictions
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FOOTY ORACLE V2 (Presentation Layer)                        â”‚
â”‚  Repo: github.com/dannythehat/footy-oracle-v2               â”‚
â”‚                                                               â”‚
â”‚  âœ… React frontend with neon purple/black theme             â”‚
â”‚  âœ… Displays Golden Bets (Top 3 daily picks)                â”‚
â”‚  âœ… Shows fixture predictions across 4 markets              â”‚
â”‚  âœ… GPT-4 powered AI reasoning for each bet                 â”‚
â”‚  âœ… P&L tracking and historical results                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”— How They Connect

### 1. **Data Flow Architecture**

```
[API-Football] â†’ [LM System] â†’ [JSON Files] â†’ [Oracle Backend] â†’ [Oracle Frontend]
     â†“              â†“              â†“               â†“                  â†“
  Fixtures    ML Predictions   Storage      API Endpoints      User Interface
```

### 2. **Integration Points**

#### A. **Shared ML Outputs** (Primary Integration)

The LM system generates prediction files that Oracle consumes:

**Location:** `shared/ml_outputs/` (in Oracle repo)

**Files Generated by LM System:**
```
shared/ml_outputs/
â”œâ”€â”€ predictions.json       # All fixture predictions (4 markets)
â”œâ”€â”€ golden_bets.json      # Top 3 daily Golden Bets
â”œâ”€â”€ value_bets.json       # Positive EV opportunities
â””â”€â”€ metadata.json         # Model performance metrics
```

**Oracle Backend Reads These Files:**
```typescript
// apps/backend/src/services/predictions.service.ts
import predictions from '../../../shared/ml_outputs/predictions.json';
import goldenBets from '../../../shared/ml_outputs/golden_bets.json';
```

#### B. **API Integration** (Secondary - Future)

Oracle can also call the LM System's REST API directly:

**LM System API Endpoints:**
```
Base URL: https://your-lm-system.onrender.com

POST /api/v1/predictions/smart-bets
POST /api/v1/predictions/golden-bets
POST /api/v1/predictions/value-bets
POST /api/v1/predictions/custom-analysis
```

**Oracle Backend Can Call:**
```typescript
// apps/backend/src/services/lm-client.service.ts
const response = await fetch('https://lm-system.onrender.com/api/v1/predictions/golden-bets', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ date: '2025-11-24' })
});
```

---

## ðŸ¤– The 4 Core Markets

Both systems work with **4 specific betting markets** chosen for ~2.0 odds balance:

| Market | Description | Why This Market? |
|--------|-------------|------------------|
| **BTTS** | Both Teams To Score | Popular, balanced probability |
| **Over 2.5 Goals** | Total goals > 2.5 | High liquidity, clear outcome |
| **Over 9.5 Corners** | Total corners > 9.5 | Less mainstream, value opportunities |
| **Over 3.5 Cards** | Total cards > 3.5 | Referee-dependent, pattern-based |

**Philosophy:** Find **value**, not just favorites. Models trained on 300k+ fixtures with 133+ advanced features.

---

## ðŸ“Š Data Structure Mapping

### LM System Output â†’ Oracle Input

#### **Predictions JSON Structure**

**LM System Generates:**
```json
{
  "fixtures": [
    {
      "fixture_id": "FIX001",
      "home_team": "Man City",
      "away_team": "Arsenal",
      "kickoff": "2025-11-24T15:00:00Z",
      "league": "Premier League",
      "predictions": {
        "btts": {
          "yes_probability": 0.58,
          "no_probability": 0.42,
          "confidence": 72
        },
        "over_2_5_goals": {
          "over_probability": 0.72,
          "under_probability": 0.28,
          "confidence": 85
        },
        "over_9_5_corners": {
          "over_probability": 0.65,
          "under_probability": 0.35,
          "confidence": 78
        },
        "over_3_5_cards": {
          "over_probability": 0.48,
          "under_probability": 0.52,
          "confidence": 68
        }
      },
      "golden_bet": {
        "market": "Over 2.5 Goals",
        "selection": "Over",
        "probability": 0.72,
        "confidence": 85,
        "odds": 2.10,
        "expected_value": 12.5
      }
    }
  ]
}
```

**Oracle Frontend Displays:**
- Fixture card with team names, league, kickoff time
- 4 market predictions with confidence bars
- Golden Bet highlighted with gold star icon
- AI reasoning (generated by GPT-4 via Oracle backend)

---

## ðŸ”§ Environment Configuration

### LM System (.env)

```bash
# API-Football for fixture data
API_FOOTBALL_KEY=your_key_here

# Model training configuration
MODEL_TRAINING_SCHEDULE=weekly
AUTOMATED_TESTING=enabled

# Output paths
ML_OUTPUT_PATH=./shared/ml_outputs/

# API configuration
PORT=3001
API_BASE_URL=https://lm-system.onrender.com
```

### Oracle Backend (.env)

```bash
# Server
PORT=3001
NODE_ENV=production

# API-Football (for live fixture updates)
API_FOOTBALL_KEY=your_api_football_key_here
API_FOOTBALL_BASE_URL=https://v3.football.api-sports.io

# OpenAI (for AI reasoning generation)
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4

# MongoDB (for P&L tracking)
MONGODB_URI=mongodb://localhost:27017/footy-oracle

# ML Model Integration
ML_MODEL_PATH=../../shared/ml_outputs/predictions.json
LM_SYSTEM_API_URL=https://lm-system.onrender.com/api/v1

# CORS
CORS_ORIGIN=https://footy-oracle.vercel.app

# Cron (Daily prediction refresh)
PREDICTION_CRON_SCHEDULE=0 6 * * *
```

### Oracle Frontend (.env)

```bash
# Backend API
VITE_API_BASE_URL=https://oracle-backend.railway.app

# Feature flags
VITE_ENABLE_GOLDEN_BETS=true
VITE_ENABLE_VALUE_BETS=true
VITE_ENABLE_PREDICTIONS=true
```

---

## ðŸ”„ Daily Workflow

### Morning Prediction Pipeline

**6:00 AM UTC - LM System Generates Predictions**

1. **Fixture Import**
   - LM system fetches today's fixtures from API-Football
   - Filters for supported leagues (30+ top leagues)

2. **Feature Engineering**
   - Calculates 133+ advanced features per fixture:
     - Core stats (30+ features)
     - Head-to-head analysis (18+ features)
     - Momentum indicators (25+ features)
     - Market-specific features (60+ features)

3. **Model Prediction**
   - 4 trained models predict each market
   - Confidence scores calculated
   - Golden Bet identified (highest confidence market)

4. **Output Generation**
   - Writes `predictions.json`
   - Writes `golden_bets.json` (top 3 overall)
   - Writes `value_bets.json` (positive EV opportunities)

**6:30 AM UTC - Oracle Backend Processes**

5. **File Sync**
   - Oracle backend reads new JSON files
   - Validates data structure
   - Stores in MongoDB for P&L tracking

6. **AI Reasoning Generation**
   - GPT-4 generates detailed explanations for Golden Bets
   - Contextual analysis based on fixture data
   - Educational tone for user understanding

7. **API Update**
   - Oracle API endpoints serve fresh predictions
   - Frontend cache invalidated

**7:00 AM UTC - Frontend Refresh**

8. **User Interface Update**
   - Homepage displays new Top 3 Golden Bets
   - Fixture page shows all predictions
   - P&L dashboard updates with previous day's results

---

## ðŸ§  ML Model Architecture (LM System)

### Phase 1: Advanced Feature Engineering âœ… COMPLETE

**133+ Intelligent Features:**

1. **Core Statistics (30+ features)**
   - Rolling averages (5, 10, 20 games)
   - Weighted form with exponential decay
   - Variance and consistency metrics
   - Streak analysis (wins, goals, clean sheets)
   - Venue-specific performance splits
   - Time-based scoring patterns

2. **Head-to-Head Analysis (18+ features)**
   - Historical matchup outcomes
   - Scoring trends in H2H fixtures
   - Venue-specific H2H performance
   - Dominance indicators

3. **Momentum Analysis (25+ features)**
   - Psychological and form factors
   - Scoring/defensive momentum
   - Confidence and pressure indicators
   - Fatigue and fixture congestion

4. **Market-Specific Features (60+ features)**
   - **Goals O/U 2.5:** xG, shots, conversion (16 features)
   - **Corners O/U 9.5:** Possession, style (14 features)
   - **Cards O/U 3.5:** Discipline, referee (15 features)
   - **BTTS Y/N:** Clean sheets, consistency (15 features)

### Phase 2: Deep Learning Ensemble ðŸ”„ NEXT

**Planned Architecture:**
- XGBoost (current baseline)
- LightGBM (speed + accuracy)
- CatBoost (categorical handling)
- LSTM Networks (time-series patterns)
- Transformer Architecture (complex relationships)
- Ensemble Voting (weighted aggregation)

**Target Performance:**
- Accuracy: 65% â†’ 75-80%
- Golden Bets Win Rate: 85% â†’ 90%+
- Value Bets ROI: 10-15% â†’ 20-30%

---

## ðŸŽ¨ Oracle Frontend Features

### 1. **Golden Bets Page** (Homepage)

**Displays:**
- Top 3 Golden Bets of the day
- Gold star icon for each bet
- Confidence percentage (85%+)
- Odds and expected value
- GPT-4 AI reasoning
- Treble calculator (â‚¬10 ACCA)

**Data Source:**
```typescript
// Fetches from Oracle backend
GET /api/golden-bets/today

// Backend reads from LM system output
shared/ml_outputs/golden_bets.json
```

### 2. **Fixtures Page**

**Displays:**
- All fixtures for selected date
- FlashScore-style layout
- 4 market predictions per fixture
- Confidence bars for each market
- Golden Bet highlighted per fixture

**Data Source:**
```typescript
GET /api/fixtures?date=2025-11-24

// Backend reads from LM system output
shared/ml_outputs/predictions.json
```

### 3. **Historical Results Page**

**Displays:**
- P&L tracking (daily, weekly, monthly, yearly)
- Win rate statistics
- Export functionality
- Performance charts

**Data Source:**
```typescript
GET /api/stats/pnl?period=monthly

// Backend queries MongoDB
// Results stored after each fixture completion
```

---

## ðŸš€ Deployment Architecture

### LM System Deployment

**Platform:** Render (Free Tier)

**Services:**
- Web Service: FastAPI application
- PostgreSQL: Model metadata storage
- Redis: Caching layer
- Cron Jobs: Weekly training, 6-hour testing

**Auto-Deploy:**
```yaml
# .github/workflows/train-models.yml
- Runs weekly (Sundays 2 AM UTC)
- Trains 4 models
- Commits updated models to repo
- Triggers deployment

# .github/workflows/full-test-deploy.yml
- Runs every 6 hours
- Tests all 4 AI components
- Commits test results
- Updates documentation
```

### Oracle Deployment

**Frontend:** Vercel
- Auto-deploy on push to main
- Environment: `VITE_API_BASE_URL`

**Backend:** Railway
- Auto-deploy on push to main
- Environment: API keys, MongoDB URI, LM system URL

---

## ðŸ” API Keys Required

### For LM System:
```bash
API_FOOTBALL_KEY=xxx  # Fixture data (already added)
```

### For Oracle:
```bash
API_FOOTBALL_KEY=xxx      # Live fixture updates (already added)
OPENAI_API_KEY=xxx        # AI reasoning generation (already added)
MONGODB_URI=xxx           # P&L tracking database
```

**âœ… All keys already configured in .env files**

---

## ðŸ§ª Testing the Integration

### 1. **Test LM System Predictions**

```bash
# In football-betting-ai-system repo
cd smart-bets-ai
python predict.py

# Should output predictions.json
cat ../shared/ml_outputs/predictions.json
```

### 2. **Test Oracle Backend Reading**

```bash
# In footy-oracle-v2 repo
cd apps/backend
npm run dev

# Test endpoint
curl http://localhost:3001/api/fixtures?date=2025-11-24
```

### 3. **Test Full Pipeline**

```bash
# 1. Generate predictions (LM system)
cd football-betting-ai-system
python smart-bets-ai/predict.py

# 2. Copy to Oracle (if separate repos)
cp shared/ml_outputs/*.json ../footy-oracle-v2/shared/ml_outputs/

# 3. Start Oracle backend
cd ../footy-oracle-v2/apps/backend
npm run dev

# 4. Start Oracle frontend
cd ../frontend
npm run dev

# 5. Visit http://localhost:3000
```

---

## ðŸ“ Key Differences: LM System vs Oracle

| Aspect | LM System | Oracle |
|--------|-----------|--------|
| **Purpose** | ML engine, prediction generation | User interface, presentation |
| **Tech Stack** | Python, FastAPI, XGBoost | TypeScript, React, Express |
| **Data Flow** | Generates predictions | Consumes predictions |
| **Automation** | Weekly training, 6-hour testing | Daily frontend refresh |
| **Output** | JSON files, REST API | Web interface |
| **Users** | Developers, data scientists | End users (bettors) |
| **Deployment** | Render (backend service) | Vercel (frontend) + Railway (backend) |

---

## âœ… Summary

**The Integration in One Sentence:**

> The **Football Betting AI System** trains ML models and generates predictions (JSON files), which the **Footy Oracle v2** reads and displays through a beautiful React interface with GPT-4 powered explanations.

**Key Points:**
1. âœ… LM system = ML engine (Python, 133+ features, 4 models)
2. âœ… Oracle = Presentation layer (React, neon purple theme, GPT-4 reasoning)
3. âœ… Integration = JSON files in `shared/ml_outputs/`
4. âœ… All API keys already configured in .env files
5. âœ… Automated: LM trains weekly, Oracle refreshes daily
6. âœ… 4 markets: BTTS, Over 2.5 Goals, Over 9.5 Corners, Over 3.5 Cards

**You're all set! ðŸš€**
